#FRONTEND_PORT = 8601
#BACKEND_PORT = 5008

<VirtualHost *:443>
    ServerName SCRATCH_DOMAIN

    SSLEngine on
    SSLCertificateFile /path/to/cert.combine
    SSLCertificateKeyFile /path/to/private.key

    # Set CORS headers for all responses
    Header always set Access-Control-Allow-Origin "SCRATCH_DOMAIN"
    Header always set Access-Control-Allow-Methods "GET, POST, PUT, DELETE, OPTIONS"
    Header always set Access-Control-Allow-Headers "Content-Type, Authorization, X-Session-ID, Cookie, Set-Cookie"
    Header always set Access-Control-Allow-Credentials "true"

    # Handle OPTIONS preflight requests
    RewriteEngine On
    RewriteCond %{REQUEST_METHOD} OPTIONS
    RewriteRule ^(.*)$ $1 [R=200,L]

    # Forward proper headers for OAuth
    ProxyPreserveHost On
    RequestHeader set X-Forwarded-Proto "https"
    RequestHeader set X-Forwarded-Host "SCRATCH_DOMAIN"
    RequestHeader set X-Forwarded-Port "443"

    # WebSocket connections
    ProxyPass "/ws" "ws://SCRATCH_IP:8601/ws"
    ProxyPassReverse "/ws" "ws://SCRATCH_IP:8601/ws"


    <Location /backend/api/>
        ProxyPass http://SCRATCH_IP:5008/api/
        ProxyPassReverse http://SCRATCH_IP:5008/api/
    </Location>


    # Backend API - make sure to pass cookies and headers correctly
    <Location /backend/>
        ProxyPass http://SCRATCH_IP:5008/
        ProxyPassReverse http://SCRATCH_IP:5008/
    </Location>

    # Frontend application
    ProxyPass / http://SCRATCH_IP:8601/
    ProxyPassReverse / http://SCRATCH_IP:8601/

    # Logging
    ErrorLog ${APACHE_LOG_DIR}/scratch_error.log
    CustomLog ${APACHE_LOG_DIR}/scratch_access.log combined
</VirtualHost>

<VirtualHost *:80>
    ServerName SCRATCH_DOMAIN
    Redirect permanent / https://SCRATCH_DOMAIN/
</VirtualHost>
